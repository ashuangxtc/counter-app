<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>汉堡节同步计数器</title>
<style>
  body { font-family: Arial, sans-serif; background:#f4f4f4; padding:10px; }
  .container { max-width: 480px; margin: auto; background: white; padding: 15px; border-radius: 8px; }
  h2 { text-align: center; }
  .product { border: 1px solid #ddd; border-radius: 6px; padding: 12px; margin-bottom: 12px; }
  .product h3 { margin-top: 0; }
  .status-row { display: flex; justify-content: space-between; align-items: center; margin: 6px 0; }
  .status-label { flex: 1; }
  .count { width: 50px; text-align: center; font-weight: bold; }
  button { padding: 6px 12px; margin-left: 6px; border: none; border-radius: 4px; cursor: pointer; background: #28a745; color: white; }
  button.decrease { background: #dc3545; }
  @media (max-width: 400px) {
    .status-row { flex-direction: column; align-items: flex-start; }
    button { margin: 4px 0 0 0; width: 100%; }
  }
</style>
</head>
<body>

<div class="container">
  <h2>汉堡节实时计数器</h2>

  <div class="product" data-name="投名状">
    <h3>投名状</h3>
    <div class="status-row">
      <div class="status-label">制作中</div>
      <div class="count" id="投名状-制作中">0</div>
      <button class="decrease" data-product="投名状" data-status="制作中">-</button>
      <button data-product="投名状" data-status="制作中">+</button>
    </div>
    <div class="status-row">
      <div class="status-label">新下单</div>
      <div class="count" id="投名状-新下单">0</div>
      <button class="decrease" data-product="投名状" data-status="新下单">-</button>
      <button data-product="投名状" data-status="新下单">+</button>
    </div>
    <div class="status-row">
      <div class="status-label">已出餐</div>
      <div class="count" id="投名状-已出餐">0</div>
      <button class="decrease" data-product="投名状" data-status="已出餐">-</button>
      <button data-product="投名状" data-status="已出餐">+</button>
    </div>
  </div>

  <div class="product" data-name="苏贵">
    <h3>苏贵</h3>
    <div class="status-row">
      <div class="status-label">制作中</div>
      <div class="count" id="苏贵-制作中">0</div>
      <button class="decrease" data-product="苏贵" data-status="制作中">-</button>
      <button data-product="苏贵" data-status="制作中">+</button>
    </div>
    <div class="status-row">
      <div class="status-label">新下单</div>
      <div class="count" id="苏贵-新下单">0</div>
      <button class="decrease" data-product="苏贵" data-status="新下单">-</button>
      <button data-product="苏贵" data-status="新下单">+</button>
    </div>
    <div class="status-row">
      <div class="status-label">已出餐</div>
      <div class="count" id="苏贵-已出餐">0</div>
      <button class="decrease" data-product="苏贵" data-status="已出餐">-</button>
      <button data-product="苏贵" data-status="已出餐">+</button>
    </div>
  </div>

  <div class="product" data-name="薯条">
    <h3>薯条</h3>
    <div class="status-row">
      <div class="status-label">制作中</div>
      <div class="count" id="薯条-制作中">0</div>
      <button class="decrease" data-product="薯条" data-status="制作中">-</button>
      <button data-product="薯条" data-status="制作中">+</button>
    </div>
    <div class="status-row">
      <div class="status-label">新下单</div>
      <div class="count" id="薯条-新下单">0</div>
      <button class="decrease" data-product="薯条" data-status="新下单">-</button>
      <button data-product="薯条" data-status="新下单">+</button>
    </div>
    <div class="status-row">
      <div class="status-label">已出餐</div>
      <div class="count" id="薯条-已出餐">0</div>
      <button class="decrease" data-product="薯条" data-status="已出餐">-</button>
      <button data-product="薯条" data-status="已出餐">+</button>
    </div>
  </div>

</div>

<script type="module">
// Firebase 9+ SDK 模块导入
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, set, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBlbT-kHH9bzj6-dkoclB1leVISeGF_K4k",
  authDomain: "counter-app-7306d.firebaseapp.com",
  databaseURL: "https://counter-app-7306d-default-rtdb.firebaseio.com",
  projectId: "counter-app-7306d",
  storageBucket: "counter-app-7306d.firebasestorage.app",
  messagingSenderId: "904451625856",
  appId: "1:904451625856:web:27dfa060dc6345d6576765",
  measurementId: "G-8LRWWZVJZR"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// 监听整个 counters 节点，实时更新页面
const countersRef = ref(db, 'counters');

function updateCountDisplay(data) {
  if (!data) return;
  for (const product in data) {
    for (const status in data[product]) {
      const id = `${product}-${status}`;
      const el = document.getElementById(id);
      if (el) {
        el.textContent = data[product][status];
      }
    }
  }
}

onValue(countersRef, (snapshot) => {
  updateCountDisplay(snapshot.val());
});

// 按钮事件绑定
document.querySelectorAll('button').forEach(button => {
  button.addEventListener('click', async () => {
    const product = button.getAttribute('data-product');
    const status = button.getAttribute('data-status');
    if (!product || !status) return;

    // 获取当前计数
    const countRef = ref(db, `counters/${product}/${status}`);
    const snapshot = await get(countRef);
    let current = snapshot.val() || 0;

    if (button.classList.contains('decrease')) {
      current = Math.max(0, current - 1);
    } else {
      current = current + 1;
    }

    await set(countRef, current);
  });
});
</script>

</body>
</html>
